<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reset Your Password</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    .reset-container { background: white; padding: 2rem; border-radius: 8px; max-width: 400px; width: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; text-align: center; color: #333; }
    label { display: block; margin-top: 1rem; font-weight: bold; color: #555; }
    input { width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
    button { margin-top: 1.5rem; width: 100%; padding: 0.75rem; background: #007bff; border: none; border-radius: 4px; color: white; font-size: 1rem; cursor: pointer; }
    button:hover { background: #0056b3; }
    .message { margin-top: 1rem; text-align: center; font-size: 0.95rem; }
    .success { color: green; }
    .error { color: red; }
</style>
</head>
<body>

<div class="reset-container">
    <h2>Reset Password</h2>
    <label for="password">New Password</label>
    <input type="password" id="password" placeholder="Enter new password" />

    <!-- Store token from server -->
    <input type="hidden" id="token" value="{{ token }}">

    <button id="resetBtn">Reset Password</button>
    <div class="message" id="message"></div>
</div>

<script>
document.getElementById('resetBtn').addEventListener('click', async () => {
    const token = document.getElementById('token').value.trim();
    const newPassword = document.getElementById('password').value.trim();
    const messageEl = document.getElementById('message');
    messageEl.textContent = '';
    messageEl.className = 'message';

    if (!token || !newPassword) {
        messageEl.textContent = 'Missing token or password.';
        messageEl.classList.add('error');
        return;
    }

    try {
        const res = await fetch('/api/reset-password/confirm', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token, new_password: newPassword })
        });

        const data = await res.json();
        if (res.ok) {
            messageEl.textContent = data.message || 'Password reset successful!';
            messageEl.classList.add('success');
        } else {
            messageEl.textContent = data.error || 'Password reset failed.';
            messageEl.classList.add('error');
        }
    } catch (err) {
        messageEl.textContent = 'Network error. Please try again.';
        messageEl.classList.add('error');
    }
});
</script>

</body>
</html>
